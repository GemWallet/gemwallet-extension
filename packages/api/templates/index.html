<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GemWallet API</title>
  </head>

  <body>
    <div id="wrapper">
      <button onclick="handlePayment()">Pay XRP</button>
      <button onclick="handlePayment('ETH', 'rnm76Qgz4G9G4gZBJVuXVvkbt7gVD7szey')">Pay ETH</button>
      <button onclick="handleTrustline()">Add trustline (ETH)</button>
      <button onclick="handleGetNFT()">Get NFTs (check the console)</button>
      <button onclick="handleMintNFT()">Mint NFTs (check the console)</button>
      <button onclick="handlePublicKey()">Get Public Key (check the console)</button>
      <button onclick="handleGetAddress()">Get Address (check the console)</button>
      <button onclick="handleGetNetwork()">Get Network (check the console)</button>
      <button onclick="handleSignMessage()">Sign message</button>
      <div id="address"></div>
    </div>
  </body>
</html>

<script>
  function formatAmount(value, currency, issuer) {
    if (currency && issuer) {
      return {
        currency,
        issuer,
        value: `${value}`
      };
    }

    // If the currency or issuer is not provided, the amount needs to be in drops
    return `${value * 1000000}`;
  }

  function handlePayment(currency, issuer) {
    GemWalletApi.isInstalled()
      .then(({ result }) => {
        if (result.isInstalled) {
          const payment = {
            amount: formatAmount(0.2, currency, issuer),
            destination: issuer || 'rNvFCZXpDtGeQ3bVas95wGLN6N2stGmA9o',
            memos: [
              {
                memo: {
                  memoType: '4465736372697074696f6e',
                  memoData: '54657374206d656d6f'
                }
              }
            ],
            destinationTag: 12,
            fee: '199',
            flags: {
              tfNoDirectRipple: false,
              tfPartialPayment: false,
              tfLimitQuality: false
            }
          };
          const addressContainer = document.getElementById('address');
          GemWalletApi.sendPayment(payment)
            .then((res) => {
              addressContainer.insertAdjacentText(
                'afterbegin',
                `Received object: ${JSON.stringify(res)}`
              );
            })
            .catch((e) => {
              addressContainer.insertAdjacentText(
                'afterbegin',
                `Received error: ${e.message} ${e.stack} ${e.name}`
              );
              console.error('Cannot proceed the payment: ', e);
            });
        }
      })
      .catch((e) => {
        console.error('GemWallet is not connected: ', e);
      });
  }
  function handleTrustline() {
    GemWalletApi.isInstalled()
      .then(({ result }) => {
        if (result.isInstalled) {
          const transaction = {
            limitAmount: {
              currency: 'ETH',
              issuer: 'rnm76Qgz4G9G4gZBJVuXVvkbt7gVD7szey',
              value: '10000000'
            },
            memos: [
              {
                memo: {
                  memoType: '4465736372697074696f6e',
                  memoData: '54657374206d656d6f'
                }
              }
            ],
            fee: '199',
            flags: {
              tfClearFreeze: false,
              tfClearNoRipple: false,
              tfSetFreeze: true,
              tfSetNoRipple: true,
              tfSetfAuth: false
            }
          };
          GemWalletApi.setTrustline(transaction)
            .then((res) => {
              const addressContainer = document.getElementById('address');
              addressContainer.insertAdjacentText(
                'afterbegin',
                `Received object: ${JSON.stringify(res)}`
              );
            })
            .catch((e) => {
              console.error('Cannot proceed the transaction: ', e);
            });
        }
      })
      .catch((e) => {
        console.error('GemWallet is not connected: ', e);
      });
  }
  function handleGetNFT() {
    GemWalletApi.isInstalled()
      .then(({ result }) => {
        if (result.isInstalled) {
          const props = {
            limit: 1
          };
          GemWalletApi.getNFT(props)
            .then((nfts) => {
              console.log('Here are your NFTs: ', nfts);
            })
            .catch((e) => {
              console.error('Something went wrong: ', e);
            });
        }
      })
      .catch((e) => {
        console.error('GemWallet is not connected: ', e);
      });
  }
  function handlePublicKey() {
    GemWalletApi.isInstalled()
      .then(({ result }) => {
        if (result.isInstalled) {
          GemWalletApi.getPublicKey()
            .then((pbk) => {
              console.log('Here is your Public Key: ', pbk);
            })
            .catch((e) => {
              console.error('Something went wrong: ', e);
            });
        }
      })
      .catch((e) => {
        console.error('GemWallet is not connected: ', e);
      });
  }
  function handleGetAddress() {
    GemWalletApi.isInstalled()
      .then(({ result }) => {
        if (result.isInstalled) {
          GemWalletApi.getAddress()
            .then((address) => {
              console.log('Here is your address: ', address);
            })
            .catch((e) => {
              console.error('Something went wrong: ', e);
            });
        }
      })
      .catch((e) => {
        console.error('GemWallet is not connected: ', e);
      });
  }
  function handleGetNetwork() {
    GemWalletApi.isInstalled().then(({ result }) => {
      if (result.isInstalled) {
        GemWalletApi.getNetwork()
          .then((network) => {
            console.log('Here is your network: ', network);
          })
          .catch((e) => {
            console.error('Something went wrong: ', e);
          });
      }
    });
  }
  function handleSignMessage() {
    GemWalletApi.isInstalled()
      .then(({ result }) => {
        if (result.isInstalled) {
          const message = 'Hello World!';
          GemWalletApi.signMessage(message)
            .then((signature) => {
              console.log('Here is your signature: ', signature);
            })
            .catch((e) => {
              console.error('Something went wrong: ', e);
            });
        }
      })
      .catch((e) => {
        console.error('GemWallet is not connected: ', e);
      });
  }
  function handleMintNFT() {
    GemWalletApi.isInstalled()
      .then(({ result }) => {
        if (result.isInstalled) {
          const transaction = {
            URI: '4d696e746564207468726f7567682047656d57616c6c657421',
            flags: {
              tfOnlyXRP: true,
              tfTransferable: true
            },
            fee: '199',
            transferFee: 3000, // 3%,
            NFTokenTaxon: 0,
            memos: [
              {
                memo: {
                  memoType: '4465736372697074696f6e',
                  memoData: '54657374206d656d6f'
                }
              }
            ]
          };

          GemWalletApi.mintNFT(transaction)
            .then((res) => {
              console.log('Received response: ', res);
            })
            .catch((e) => {
              console.error('Cannot proceed the transaction: ', e);
            });
        }
      })
      .catch((e) => {
        console.error('GemWallet is not connected: ', e);
      });
  }
</script>
